(()=>{(function(){"use strict";document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(i){if(i.target.closest(".digifusion-plugin-action")){i.preventDefault();let t=i.target.closest(".digifusion-plugin-action"),n=t.dataset.plugin,s=t.dataset.action;if(t.dataset.url){window.open(t.dataset.url,"_blank");return}t.disabled=!0;let e=t.querySelector("span"),r=e.textContent;s==="install"?(e.textContent=digifusionVars.strings.installing,u(n,t,r)):s==="activate"&&(e.textContent=digifusionVars.strings.activating,g(n,t,r))}});function u(i,t,n){let s=new FormData;s.append("action","digifusion_install_plugin"),s.append("plugin",i),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(e=>e.json()).then(e=>{e.success?(a(e.data.message,"success"),d(t,e.data.status,i)):(a(e.data||digifusionVars.strings.error,"error"),c(t,n))}).catch(e=>{console.error("Error:",e),a(digifusionVars.strings.error,"error"),c(t,n)})}function g(i,t,n){let s=new FormData;s.append("action","digifusion_activate_plugin"),s.append("plugin",i),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(e=>e.json()).then(e=>{e.success?(a(e.data.message,"success"),d(t,e.data.status,i)):(a(e.data||digifusionVars.strings.error,"error"),c(t,n))}).catch(e=>{console.error("Error:",e),a(digifusionVars.strings.error,"error"),c(t,n)})}function d(i,t,n){i.disabled=!1,i.classList.remove("button-primary","button-secondary"),i.classList.add(t.button_class),i.querySelector("span").textContent=t.button_text,t.status==="active"?(i.dataset.action="learn_more",i.dataset.url=t.url):t.status==="inactive"?(i.dataset.action="activate",delete i.dataset.url):(i.dataset.action="install",delete i.dataset.url)}function c(i,t){i.disabled=!1,i.querySelector("span").textContent=t}function a(i,t){document.querySelectorAll(".digifusion-notification").forEach(o=>o.remove());let e=`
                <div class="notice ${t==="success"?"notice-success":"notice-error"} is-dismissible digifusion-notification" style="margin: 1rem 0;">
                    <p>${i}</p>
                    <button type="button" class="notice-dismiss">
                        <span class="screen-reader-text">Dismiss this notice.</span>
                    </button>
                </div>
            `,r=document.querySelector(".digifusion-admin-content");if(r){r.insertAdjacentHTML("beforebegin",e);let o=r.previousElementSibling;o&&o.classList.contains("digifusion-notification")&&(o.querySelector(".notice-dismiss").addEventListener("click",function(){l(o,300,function(){o.remove()})}),t==="success"&&setTimeout(function(){o&&o.parentNode&&l(o,300,function(){o.remove()})},5e3))}}function l(i,t,n){i.style.transition=`opacity ${t}ms`,i.style.opacity="0",setTimeout(function(){n&&n()},t)}function f(){document.querySelectorAll(".digifusion-plugin-action").forEach(function(t){let n=t.dataset.plugin,s=new FormData;s.append("action","digifusion_get_plugin_status"),s.append("plugin",n),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(e=>e.json()).then(e=>{e.success&&d(t,e.data.status,n)}).catch(e=>{console.error("Error checking plugin status:",e)})})}f()})})();})();
