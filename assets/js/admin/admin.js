(()=>{(function(){"use strict";document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",function(n){if(n.target.closest(".digifusion-plugin-action")){n.preventDefault();let i=n.target.closest(".digifusion-plugin-action"),e=i.dataset.plugin,s=i.dataset.action;if(i.dataset.url){window.open(i.dataset.url,"_blank");return}i.disabled=!0;let t=i.querySelector("span"),c=t.textContent;s==="install"?(t.textContent=digifusionVars.strings.installing,l(e,i,c)):s==="activate"&&(t.textContent=digifusionVars.strings.activating,f(e,i,c))}});function l(n,i,e){let s=new FormData;s.append("action","digifusion_install_plugin"),s.append("plugin",n),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(t=>t.json()).then(t=>{t.success?(a(t.data.message,"success"),u(i,t.data.status,n)):(a(t.data||digifusionVars.strings.error,"error"),r(i,e))}).catch(t=>{console.error("Error:",t),a(digifusionVars.strings.error,"error"),r(i,e)})}function f(n,i,e){let s=new FormData;s.append("action","digifusion_activate_plugin"),s.append("plugin",n),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(t=>t.json()).then(t=>{t.success?(a(t.data.message,"success"),u(i,t.data.status,n)):(a(t.data||digifusionVars.strings.error,"error"),r(i,e))}).catch(t=>{console.error("Error:",t),a(digifusionVars.strings.error,"error"),r(i,e)})}function u(n,i,e){n.disabled=!1,n.classList.remove("button-primary","button-secondary"),n.classList.add(i.button_class),n.querySelector("span").textContent=i.button_text,i.status==="active"?(n.dataset.action="learn_more",n.dataset.url=i.url):i.status==="inactive"?(n.dataset.action="activate",delete n.dataset.url):(n.dataset.action="install",delete n.dataset.url)}function r(n,i){n.disabled=!1,n.querySelector("span").textContent=i}function a(n,i){document.querySelectorAll(".digifusion-notification").forEach(o=>o.remove());let t=`
                <div class="notice ${i==="success"?"notice-success":"notice-error"} is-dismissible digifusion-notification" style="margin: 1rem 0;">
                    <p>${n}</p>
                    <button type="button" class="notice-dismiss">
                        <span class="screen-reader-text">Dismiss this notice.</span>
                    </button>
                </div>
            `,c=document.querySelector(".digifusion-admin-content");if(c){c.insertAdjacentHTML("beforebegin",t);let o=c.previousElementSibling;o&&o.classList.contains("digifusion-notification")&&(o.querySelector(".notice-dismiss").addEventListener("click",function(){d(o,300,function(){o.remove()})}),i==="success"&&setTimeout(function(){o&&o.parentNode&&d(o,300,function(){o.remove()})},5e3))}}function d(n,i,e){n.style.transition=`opacity ${i}ms`,n.style.opacity="0",setTimeout(function(){e&&e()},i)}function g(){document.querySelectorAll(".digifusion-plugin-action").forEach(function(i){let e=i.dataset.plugin,s=new FormData;s.append("action","digifusion_get_plugin_status"),s.append("plugin",e),s.append("nonce",digifusionVars.nonce),fetch(digifusionVars.ajax_url,{method:"POST",body:s}).then(t=>t.json()).then(t=>{t.success&&u(i,t.data.status,e)}).catch(t=>{console.error("Error checking plugin status:",t)})})}g()})})();})();
