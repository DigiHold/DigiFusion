(()=>{document.addEventListener("DOMContentLoaded",function(){let y=document.querySelectorAll(".digifusion-cart-icon-wrapper");if(!y.length)return;if(typeof digifusionCartData>"u"){console.error("DigiFusion Cart Icon: Missing AJAX data");return}let T=1024;function u(){return window.innerWidth<=T}function w(t,a){t.style.display="flex",t.style.height="0px",t.style.overflow="hidden",t.style.transition=`height ${a}ms ease-in-out`;let d=t.scrollHeight;requestAnimationFrame(()=>{t.style.height=d+"px"}),setTimeout(()=>{t.style.height="",t.style.overflow="",t.style.transition=""},a)}function m(t,a,d){let p=t.scrollHeight;t.style.height=p+"px",t.style.overflow="hidden",t.style.transition=`height ${a}ms ease-in-out`,requestAnimationFrame(()=>{t.style.height="0px"}),setTimeout(()=>{t.style.height="",t.style.overflow="",t.style.transition="",t.style.display="none",d&&d()},a)}y.forEach(function(t){q(t)});function q(t){let a=t.querySelector(".digifusion-cart-icon-icon"),d=t.querySelector(".digifusion-cart-count"),p=t.querySelector(".digifusion-cart-total"),o=t.querySelector(".digifusion-mini-cart"),b=o?o.querySelector(".digifusion-mini-cart-content"):null,s=t.querySelector(".digifusion-cart-icon-link"),_=!1,h=!1,v=s?s.dataset.showMiniCart==="true":!1;function l(n,e,i){d&&(d.textContent=n),p&&(p.innerHTML=i||e),t.classList.toggle("cart-empty",n===0),t.classList.toggle("cart-has-items",n>0)}function k(){return new Promise(function(n){let e=new FormData;e.append("action","digifusion_get_cart_items"),fetch(digifusionCartData.ajax_url,{method:"POST",body:e,credentials:"same-origin"}).then(function(i){return i.json()}).then(function(i){i.success&&i.data.items&&c(i.data.items,i.data.total_html||i.data.total),n()}).catch(function(i){console.error("DigiFusion Cart Icon: Error fetching cart items",i),n()})})}function c(n,e){if(!b)return;let i="";n&&n.length>0?n.forEach(function(f){i+='<div class="digifusion-mini-cart-item" data-cart-item-key="'+f.key+'"><div class="digifusion-mini-cart-item-image">'+(f.image?'<img src="'+f.image+'" alt="'+f.name+'">':"")+'</div><div class="digifusion-mini-cart-item-details"><div class="digifusion-mini-cart-item-name">'+(f.permalink?'<a href="'+f.permalink+'">'+f.name+"</a>":f.name)+'</div><div class="digifusion-mini-cart-item-price">'+f.price_html+'</div></div><input type="number" class="digifusion-mini-cart-item-quantity" value="'+f.quantity+'" min="0" data-cart-item-key="'+f.key+'" aria-label="'+digifusionCartData.strings.quantity+'"><button class="digifusion-mini-cart-item-remove" data-cart-item-key="'+f.key+'" title="'+digifusionCartData.strings.remove_item+'" aria-label="'+digifusionCartData.strings.remove_item+'">&times;</button></div>'}):i='<div class="digifusion-mini-cart-empty">'+digifusionCartData.strings.empty_cart+"</div>";let C=digifusionCartData.cart_url||"",O=digifusionCartData.checkout_url||"";b.innerHTML='<div class="digifusion-mini-cart-items">'+i+"</div>"+(n&&n.length>0?'<div class="digifusion-mini-cart-total"><span>'+digifusionCartData.strings.total+'</span><span class="total-amount">'+e+'</span></div><div class="digifusion-mini-cart-buttons"><a href="'+C+'" class="digifusion-mini-cart-button secondary">'+digifusionCartData.strings.view_cart+'</a><a href="'+O+'" class="digifusion-mini-cart-button primary">'+digifusionCartData.strings.checkout+"</a></div>":"")}function L(){a&&(a.classList.add("cart-item-added"),setTimeout(function(){a.classList.remove("cart-item-added")},600))}function E(n){if(_)return;_=!0;let e=new FormData;e.append("action","digifusion_get_cart_data"),fetch(digifusionCartData.ajax_url,{method:"POST",body:e,credentials:"same-origin"}).then(function(i){if(!i.ok)throw new Error("Network response was not ok");return i.json()}).then(function(i){i.success&&(l(i.data.count,i.data.total,i.data.total_html),v?k().then(function(){n&&L()}):n&&L()),_=!1}).catch(function(i){console.error("DigiFusion Cart Icon: Error fetching cart data",i),_=!1})}function S(n,e){let i=new FormData;i.append("action","digifusion_update_cart_item"),i.append("nonce",digifusionCartData.cart_nonce),i.append("cart_item_key",n),i.append("quantity",e),fetch(digifusionCartData.ajax_url,{method:"POST",body:i,credentials:"same-origin"}).then(function(C){return C.json()}).then(function(C){C.success&&setTimeout(function(){E()},200)}).catch(function(C){console.error("DigiFusion Cart Icon: Error updating cart item",C)})}function r(n){let e=new FormData;e.append("action","digifusion_remove_cart_item"),e.append("nonce",digifusionCartData.cart_nonce),e.append("cart_item_key",n),fetch(digifusionCartData.ajax_url,{method:"POST",body:e,credentials:"same-origin"}).then(function(i){return i.json()}).then(function(i){i.success&&setTimeout(function(){E()},200)}).catch(function(i){console.error("DigiFusion Cart Icon: Error removing cart item",i)})}function M(){!o||!v||(h=!0,t.classList.add("mini-cart-open"),u()?(t.classList.add("submenu-open"),w(o,300)):o.classList.add("visible"))}function D(){!o||!v||(h=!1,t.classList.remove("mini-cart-open"),u()?m(o,300,()=>{t.classList.remove("submenu-open")}):o.classList.remove("visible"))}function j(){h?D():M()}function x(){s&&(s.removeEventListener("mouseenter",M),s.removeEventListener("mouseleave",F),s.removeEventListener("click",I),v&&(u()||(s.addEventListener("mouseenter",M),s.addEventListener("mouseleave",F)),s.addEventListener("click",I)))}function F(){u()||setTimeout(function(){!o.matches(":hover")&&!s.matches(":hover")&&D()},100)}function I(n){if(n.preventDefault(),!v){window.location.href=s.href;return}u(),j()}o&&(o.addEventListener("change",function(n){if(n.target.matches(".digifusion-mini-cart-item-quantity")){let e=n.target.dataset.cartItemKey,i=parseInt(n.target.value)||0;e&&S(e,i)}}),o.addEventListener("click",function(n){if(n.target.matches(".digifusion-mini-cart-item-remove")){n.preventDefault();let e=n.target.dataset.cartItemKey;e&&r(e)}n.stopPropagation()}),u()||o.addEventListener("mouseleave",function(){setTimeout(function(){!o.matches(":hover")&&!s.matches(":hover")&&D()},100)})),x();let H;window.addEventListener("resize",function(){clearTimeout(H),H=setTimeout(function(){x(),!u()&&h&&D()},150)}),document.addEventListener("click",function(n){u()&&!t.contains(n.target)&&h&&D()}),document.addEventListener("keydown",function(n){u()&&n.key==="Escape"&&h&&D()}),setTimeout(function(){E()},100)}document.body.addEventListener("added_to_cart",function(t){setTimeout(function(){y.forEach(function(a){let d=a.querySelector(".digifusion-cart-icon-icon");d&&(d.classList.add("cart-item-added"),setTimeout(function(){d.classList.remove("cart-item-added")},600))}),g(!0)},200)}),document.body.addEventListener("wc_fragment_refresh",function(t){setTimeout(function(){g()},100)}),document.addEventListener("submit",function(t){t.target.matches(".cart form, form.cart")&&setTimeout(function(){g(!0)},1e3)}),document.addEventListener("click",function(t){(t.target.matches(".add_to_cart_button, .single_add_to_cart_button, .ajax_add_to_cart")||t.target.closest(".add_to_cart_button, .single_add_to_cart_button, .ajax_add_to_cart"))&&setTimeout(function(){g(!0)},1e3)});function g(t){y.forEach(function(a){let d=a.querySelector(".digifusion-cart-icon-icon"),p=a.querySelector(".digifusion-cart-count"),o=a.querySelector(".digifusion-cart-total"),b=a.querySelector(".digifusion-mini-cart"),s=b?b.querySelector(".digifusion-mini-cart-content"):null,_=a.querySelector(".digifusion-cart-icon-link"),h=_?_.dataset.showMiniCart==="true":!1,v=new FormData;v.append("action","digifusion_get_cart_data"),fetch(digifusionCartData.ajax_url,{method:"POST",body:v,credentials:"same-origin"}).then(function(l){return l.json()}).then(function(l){if(l.success&&(p&&(p.textContent=l.data.count),o&&(o.innerHTML=l.data.total_html||l.data.total),a.classList.toggle("cart-empty",l.data.count===0),a.classList.toggle("cart-has-items",l.data.count>0),h&&s)){let k=new FormData;k.append("action","digifusion_get_cart_items"),fetch(digifusionCartData.ajax_url,{method:"POST",body:k,credentials:"same-origin"}).then(function(c){return c.json()}).then(function(c){if(c.success&&c.data.items){let L="";c.data.items&&c.data.items.length>0?c.data.items.forEach(function(r){L+='<div class="digifusion-mini-cart-item" data-cart-item-key="'+r.key+'"><div class="digifusion-mini-cart-item-image">'+(r.image?'<img src="'+r.image+'" alt="'+r.name+'">':"")+'</div><div class="digifusion-mini-cart-item-details"><div class="digifusion-mini-cart-item-name">'+(r.permalink?'<a href="'+r.permalink+'">'+r.name+"</a>":r.name)+'</div><div class="digifusion-mini-cart-item-price">'+r.price_html+'</div></div><input type="number" class="digifusion-mini-cart-item-quantity" value="'+r.quantity+'" min="0" data-cart-item-key="'+r.key+'" aria-label="'+digifusionCartData.strings.quantity+'"><button class="digifusion-mini-cart-item-remove" data-cart-item-key="'+r.key+'" title="'+digifusionCartData.strings.remove_item+'" aria-label="'+digifusionCartData.strings.remove_item+'">&times;</button></div>'}):L='<div class="digifusion-mini-cart-empty">'+digifusionCartData.strings.empty_cart+"</div>";let E=digifusionCartData.cart_url||"",S=digifusionCartData.checkout_url||"";s.innerHTML='<div class="digifusion-mini-cart-items">'+L+"</div>"+(c.data.items&&c.data.items.length>0?'<div class="digifusion-mini-cart-total"><span>'+digifusionCartData.strings.total+'</span><span class="total-amount">'+(c.data.total_html||c.data.total)+'</span></div><div class="digifusion-mini-cart-buttons"><a href="'+E+'" class="digifusion-mini-cart-button secondary">'+digifusionCartData.strings.view_cart+'</a><a href="'+S+'" class="digifusion-mini-cart-button primary">'+digifusionCartData.strings.checkout+"</a></div>":"")}})}})})}setInterval(function(){g()},3e4)});typeof jQuery<"u"&&jQuery(document).ready(function(y){y(document.body).on("updated_wc_div",function(){setTimeout(function(){document.querySelectorAll(".digifusion-cart-icon-wrapper").forEach(function(u){let w=new FormData;w.append("action","digifusion_get_cart_data"),fetch(digifusionCartData.ajax_url,{method:"POST",body:w}).then(m=>m.json()).then(m=>{if(m.success){let q=u.querySelector(".digifusion-cart-count"),g=u.querySelector(".digifusion-cart-total");q&&(q.textContent=m.data.count),g&&(g.innerHTML=m.data.total_html||m.data.total)}})})},100)}),y(document.body).on("updated_cart_totals",function(){setTimeout(function(){let T=new CustomEvent("wc_cart_updated");document.body.dispatchEvent(T)},100)})});})();
